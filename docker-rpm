FROM fedora:36

ARG ARCH
ARG ALTARCH
ARG APPVER
ENV APPVERSION=${APPVER}

RUN dnf update -y && dnf install -y rpmdevtools rpmlint

RUN adduser buildbot

USER buildbot

WORKDIR /home/buildbot

RUN rpmdev-setuptree

COPY --chmod=644 kestrel.spec rpmbuild/SPECS/
RUN sed -i "s/Version: .*/Version: $APPVERSION/g" rpmbuild/SPECS/kestrel.spec
COPY --chmod=644 build/kestrel-linux-v${APPVER}-${ARCH}.tar.gz rpmbuild/SOURCES/

RUN rpmbuild -bb --target ${ALTARCH} ~/rpmbuild/SPECS/kestrel.spec
