FROM fedora:36

ARG APP_VERSION

RUN dnf update -y && dnf install -y rpmdevtools rpmlint cargo

RUN adduser buildbot

USER buildbot

WORKDIR /home/buildbot

RUN rpmdev-setuptree

COPY --chmod=644 kestrel.spec rpmbuild/SPECS/

COPY --chmod=644 build/kestrel-$APP_VERSION.tar.gz rpmbuild/SOURCES/

RUN rpmbuild -bb ~/rpmbuild/SPECS/kestrel.spec
